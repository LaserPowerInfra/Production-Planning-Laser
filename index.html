<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LPI Secure Entry</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  
  <style>
    body { background: #f0f2f5; font-family: 'Segoe UI', sans-serif; min-height: 100vh; display: flex; flex-direction: column; }
    .main-card { max-width: 800px; width: 100%; margin: 30px auto; border: none; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); background: white; overflow: hidden; }
    .header { background: #0d6efd; color: white; padding: 20px; text-align: center; }
    
    /* Login Section */
    #loginSection { padding: 50px 20px; text-align: center; }
    .btn-google { background: white; color: #444; border: 1px solid #ddd; padding: 12px 25px; border-radius: 50px; font-weight: 600; display: inline-flex; align-items: center; gap: 10px; transition: 0.3s; cursor: pointer; }
    .btn-google:hover { background: #f8f9fa; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
    
    /* Form Section */
    #formSection { display: none; padding: 30px; }
    .user-badge { background: #e7f1ff; color: #0d6efd; padding: 10px; border-radius: 8px; text-align: center; margin-bottom: 25px; font-weight: bold; border: 1px solid #0d6efd; }
    .form-label { font-weight: 600; font-size: 0.9rem; margin-top: 10px; }
    .req:after { content: " *"; color: red; }
  </style>
</head>
<body>

<div class="main-card">
  <div class="header">
    <h3>ðŸš€ Production Entry System</h3>
    <p class="mb-0">Laser Power Infra</p>
  </div>

  <div id="loginSection">
    <h4 class="mb-3">Welcome!</h4>
    <p class="text-muted mb-4">Please sign in with your Google Account to access.</p>
    <button onclick="googleLogin()" class="btn-google">
      <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="25">
      Sign in with Google
    </button>
  </div>

  <div id="formSection">
    <div class="user-badge" id="userInfo"></div>

    <form id="entryForm">
      <input type="hidden" name="apiKey" value="LPI_SECRET_2026">
      <input type="hidden" id="userEmail" name="userEmail">
      <input type="hidden" id="userName" name="userName">

      <div class="mb-3">
        <label class="form-label req">MACHINE NAME</label>
        <input class="form-control" list="machineList" id="machineInput" name="machine" placeholder="Type to search..." required onchange="setCostCode()">
        <datalist id="machineList"></datalist>
      </div>

      <div class="row">
         <div class="col-md-6"><label class="form-label">Cost Code</label><input class="form-control" id="costCode" name="costCode" readonly></div>
         <div class="col-md-6"><label class="form-label req">ITEM NAME</label><input class="form-control" name="itemName" required></div>
      </div>

      <div class="row">
         <div class="col-md-4"><label class="form-label req">Plan</label><input type="number" class="form-control" id="plan" name="plan" required oninput="calc()"></div>
         <div class="col-md-4"><label class="form-label req">Mfg.</label><input type="number" class="form-control" id="mfg" name="mfg" required oninput="calc()"></div>
         <div class="col-md-4"><label class="form-label">Balance</label><input class="form-control" id="kmBalance" name="kmBalance" readonly style="background:#f8f9fa"></div>
      </div>

      <div class="row">
        <div class="col-md-6"><label class="form-label req">UM</label><select class="form-select" name="um" required><option>KG</option><option>KM</option><option>MT</option><option>NA</option></select></div>
        <div class="col-md-6"><label class="form-label req">MC NO</label><input class="form-control" name="mcNo" required></div>
      </div>

      <div class="row">
         <div class="col-4"><label class="form-label req">Target/Day</label><input type="number" class="form-control" name="targetDay" required></div>
         <div class="col-4"><label class="form-label req">RM Avail?</label><select class="form-select" name="rmAvail"><option>Yes</option><option>No</option></select></div>
         <div class="col-4"><label class="form-label req">MP Req.</label><input type="number" class="form-control" name="mpReq" required></div>
      </div>

      <div class="row">
         <div class="col-4"><label class="form-label req">Shifts</label><input type="number" class="form-control" name="shifts" required></div>
         <div class="col-4"><label class="form-label req">QC Time</label><input class="form-control" name="qcTime" required></div>
         <div class="col-4"><label class="form-label req">Working Days</label><input type="number" class="form-control" name="workingDays" required></div>
      </div>

      <div class="mb-4">
        <label class="form-label req">HOD</label>
        <select class="form-select" name="hod" required>
          <option value="" disabled selected>Select HOD</option>
          <option>ARNAB MITRA</option><option>ATINDRIYA CHAKRABORTY</option>
          <option>Sukanta Manna</option><option>HABIB SHAK</option>
          <option>Others</option>
        </select>
      </div>

      <div class="d-grid gap-2">
        <button type="submit" id="submitBtn" class="btn btn-primary btn-lg">SUBMIT DATA ðŸ“¤</button>
      </div>
    </form>
    
    <div class="text-center mt-3">
        <button onclick="logout()" class="btn btn-sm btn-outline-danger">Sign Out</button>
    </div>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

  // âž¤ à¦†à¦ªà¦¨à¦¾à¦° Firebase Config (à¦›à¦¬à¦¿ à¦¥à§‡à¦•à§‡ à¦¨à§‡à¦“à§Ÿà¦¾)
const firebaseConfig = {
  apiKey: "AIzaSyDywbG-rcyBHFB6OhuJesqasadBYDRlrJk",
  authDomain: "laser-html-apps.firebaseapp.com",
  projectId: "laser-html-apps",
  storageBucket: "laser-html-apps.firebasestorage.app",
  messagingSenderId: "919012116249",
  appId: "1:919012116249:web:3699a77a34c8c8facd6788",
  measurementId: "G-2G6RBP5V3N"
};

  // âž¤ à¦à¦–à¦¾à¦¨à§‡ à¦†à¦ªà¦¨à¦¾à¦° APPS SCRIPT URL à¦Ÿà¦¿ à¦¦à¦¿à¦¨
  const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwZ6wULY4mEgGPWm_1r3fRL4PaIAwmscvWHbxoYxmtSzCaXRWYQMydGDfZMQsRlLgt1nw/exec";

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();

  // à§§. à¦²à¦—à¦‡à¦¨
  window.googleLogin = function() {
    signInWithPopup(auth, provider).catch((error) => {
      Swal.fire("Login Failed", error.message, "error");
    });
  };

  // à§¨. à¦²à¦—à¦†à¦‰à¦Ÿ
  window.logout = function() {
    signOut(auth).then(() => location.reload());
  };

  // à§©. à¦‡à¦‰à¦œà¦¾à¦° à¦šà§‡à¦•
  onAuthStateChanged(auth, (user) => {
    if (user) {
      document.getElementById("loginSection").style.display = "none";
      document.getElementById("formSection").style.display = "block";
      document.getElementById("userInfo").innerHTML = `ðŸ‘¤ Logged in as: <b>${user.displayName}</b> <br> <small>${user.email}</small>`;
      document.getElementById("userEmail").value = user.email;
      document.getElementById("userName").value = user.displayName;
      loadMachines();
    } else {
      document.getElementById("loginSection").style.display = "block";
      document.getElementById("formSection").style.display = "none";
    }
  });

  // à§ª. à¦®à§‡à¦¶à¦¿à¦¨ à¦²à¦¿à¦¸à§à¦Ÿ
  function loadMachines() {
    fetch(SCRIPT_URL).then(r => r.json()).then(data => {
        window.machines = data;
        let list = document.getElementById("machineList");
        list.innerHTML = "";
        data.forEach(m => {
          let op = document.createElement("option");
          op.value = m.machine;
          list.appendChild(op);
        });
      });
  }

  // à§«. à¦¸à¦¾à¦¬à¦®à¦¿à¦Ÿ
  document.getElementById("entryForm").addEventListener("submit", function(e) {
    e.preventDefault();
    let btn = document.getElementById("submitBtn");
    btn.disabled = true; btn.innerText = "Saving...";

    let formData = new FormData(this);
    let jsonData = {};
    formData.forEach((v, k) => jsonData[k] = v);

    fetch(SCRIPT_URL, {
      method: "POST",
      body: JSON.stringify(jsonData)
    })
    .then(r => r.json())
    .then(res => {
      if(res.result === "success") {
        Swal.fire("Success!", "Data Saved Successfully", "success");
        this.reset();
        document.getElementById("kmBalance").value = "";
      } else {
        throw new Error(res.message);
      }
    })
    .catch(err => Swal.fire("Error", err.toString(), "error"))
    .finally(() => { btn.disabled = false; btn.innerText = "SUBMIT DATA ðŸ“¤"; });
  });

  // à¦—à§à¦²à§‹à¦¬à¦¾à¦² à¦«à¦¾à¦‚à¦¶à¦¨
  window.setCostCode = function() {
    let val = document.getElementById("machineInput").value;
    let found = window.machines?.find(m => m.machine === val);
    document.getElementById("costCode").value = found ? found.costCode : "";
  };

  window.calc = function() {
    let p = parseFloat(document.getElementById("plan").value)||0;
    let m = parseFloat(document.getElementById("mfg").value)||0;
    document.getElementById("kmBalance").value = p - m;
  };
</script>

</body>
</html>

```


